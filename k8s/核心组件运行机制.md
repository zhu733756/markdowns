<!--
 * @Description: 
 * @version: 
 * @Author: zhu733756
 * @Date: 2020-08-27 13:06:00
 * @LastEditors: zhu733756
 * @LastEditTime: 2020-08-27 14:08:39
-->
## APISERVER

- Kubernetes API Server的核心功能是提供Kubernetes各类资源对象（如Pod、RC、Service等）的增、删、改、查及Watch等HTTP Rest接口，成为集群内各个功能模块之间数据交互和通信的中心枢纽
  - （1）是集群管理的API入口。
  - （2）是资源配额控制的入口。
  - （3）提供了完备的集群安全机制。

- 安全保障
  - 通过采用HTTPS安全传输通道与CA签名数字证书强制双向认证的方式，API Server的安全性得以保障
  - 为了更细粒度地控制用户或应用对Kubernetes资源对象的访问权限，Kubernetes启用了RBAC访问控制策略
    - 基于角色的访问控制 (Role-based access control, RBAC) 是一种安全功能，用于控制用户访问那些通常仅限于超级用户访问的任务。通过对进程和用户应用安全属性，RBAC 可以在多个管理员之间划分超级用户的功能。进程权利管理通过权限实现。用户权利管理通过 RBAC 实现。

- 原理
  - 首先，借助etcd提供的Watch API接口，API Server可以监听（Watch）在etcd上发生的数据操作事件，比如Pod创建事件、更新事件、删除事件等，在这些事件发生后，etcd会及时通知API Server。
  - 然后，为了让Kubernetes中的其他组件在不访问底层etcd数据库的情况下，也能及时获取资源对象的变化事件，API Server模仿etcd的Watch API接口提供了自己的Watch接口，这样一来，这些组件就能近乎实时地获取它们感兴趣的任意资源对象的相关事件通知了。

- 交互
  - kubelet进程与API Server的交互
    - 每个Node上的kubelet每隔一个时间周期，就会调用一次API Server的REST接口报告自身状态，APIServer在接收到这些信息后，会将节点状态信息更新到etcd中。
    - kubelet也通过API Server的Watch接口监听Pod信息，如果监听到新的Pod副本被调度绑定到本节点，则执行Pod对应的容器创建和启动逻辑；如果监听到Pod对象被删除，则删除本节点上相应的Pod容器；如果监听到修改Pod的信息，kubelet就会相应地修改本节点的Pod容器
  - kube-controller-manager进程与API Server的交互
    - kube-controller-manager中的Node Controller模块通过API Server提供的Watch接口实时监控Node的信息，并做相应处理
  - kube-scheduler与API Server的交互
    - Scheduler通过API Server的Watch接口监听到新建Pod副本的信息后，会检索所有符合该Pod要求的Node列表，开始执行Pod调度逻辑，在调度成功后将Pod绑定到目标节点上。

- apiserver访问缓存
  - 为了缓解集群各模块对API Server的访问压力，各功能模块都采用缓存机制来缓存数据。功能模块在某些情况下不直接访问APIServer，而是通过访问缓存数据来间接访问API Server